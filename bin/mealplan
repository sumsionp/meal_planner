#!/usr/bin/env ruby

require 'date'
require_relative '../lib/meal_planner/validator'
require_relative '../lib/meal_planner/meal'
require_relative '../lib/meal_planner/menu_day'
require_relative '../lib/meal_planner/menu'

meals = [
  Meal.new("Chicky and Rice"),
  Meal.new("Taco Salad"),
  Meal.new("Stuffed Chicken and Fried Potatoes"),
  Meal.new("Spaghetti"),
  Meal.new("Hot Wraps"),
  Meal.new("Taquitos, Rice, and Beans"),
  Meal.new("Hashbrowns, Saurkraut, and Bacon"),
  Meal.new("Fish, Coleslaw, and Rice")
]

loop do
  puts "\nWelcome to Meal Planner"

  puts "\nPlease enter the number of days to plan for"
  number_of_days = Validator.validate(/^\d+$/) do
    puts "example: 7"
    gets.chomp
  end

  #puts "\nPlease enter the date to start menu or Enter if today"
  #start_date = Validator.validate(/^(0{,1}[1-9]|1[0-2])\/(0{,1}[1-9]|[12][0-9]|3[01])\/\d{4}$/) do
    #puts "example: 2/13/2013 for Feb. 13, 2013"
    #gets.chomp
  #end

  puts "\nPlanning for #{number_of_days} days." #starting on #{start_date}."

  menu = Menu.new(Integer(number_of_days))
  menu.plan(meals)

  menu.each_menu_day do |menu_day|
    puts menu_day
  end

  loop do

    planned_meals = []
    menu.each_planned_meal do |meal|
      planned_meals << meal
    end

    puts "\nPlease choose a meal or two to switch:\n"
    planned_meals.each_with_index do |meal, i|
      puts "#{i} #{meal}"
    end

    meal_numbers_string = Validator.validate(/^[0-#{planned_meals.size - 1}]$|^[0-#{planned_meals.size - 1}],[0-#{planned_meals.size - 1}]$/) do
      puts "Example: 5\nExample: 2,4"
    gets.chomp
    end

    meal_numbers = []

    meal_numbers_string.split(",").each do |meal_number_string|
      meal_numbers << Integer(meal_number_string)
    end

    if meal_numbers.size == 1
      meal1, meal2 = planned_meals[meal_numbers[0]], nil
    else
      meal1, meal2 = planned_meals[meal_numbers[0]], planned_meals[meal_numbers[1]]
    end

    menu.switch(meal1, meal2)

    menu.each_menu_day { |menu_day| puts menu_day }
  end
  break
end
